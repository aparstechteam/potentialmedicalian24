import{_ as M}from"./ChGDjVA6.js";import{_ as N}from"./SUovRVK4.js";import{y as H,r as x,z as I,q as L,A as E,n as F,j as o,o as g,c as v,a as e,t as r,b as c,w as S,F as O,l as $,v as z,s as B,B as G,m as J,d as T,k as Z}from"./BudS9JwL.js";import{_ as K}from"./C3SLqOER.js";import{_ as Q}from"./BhNlfmVE.js";import{_ as W}from"./TQb6-wOB.js";import{H as X}from"./DsxYSGlx.js";const j=m=>new Date(m).toLocaleDateString("en-US",{timeZone:"Asia/Dhaka",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}),U=(m,y)=>{m>y&&(m=y);var u=Math.floor(m/6e4),_=(m%6e4/1e3).toFixed(0);return u+":"+(_<10?"0":"")+_},Y={key:0},ee={class:"text-2xl font-semibold my-4"},te={class:"flex justify-between mb-3"},se={class:"flex gap-4 items-end"},oe={key:0,class:"relative overflow-x-auto shadow-md sm:rounded-lg"},ae={class:"w-full text-sm text-left text-gray-500"},ne=e("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3"}," Rank "),e("th",{scope:"col",class:"px-6 py-3"}," Name "),e("th",{scope:"col",class:"px-6 py-3"}," Phone "),e("th",{scope:"col",class:"px-6 py-3"}," Institute "),e("th",{scope:"col",class:"px-6 py-3"}," Batch "),e("th",{scope:"col",class:"px-6 py-3"}," Duration "),e("th",{scope:"col",class:"px-6 py-3"}," Score "),e("th",{scope:"col",class:"px-6 py-3"}," Subjects ")])],-1),le={class:"px-6 py-4"},ce={scope:"row",class:"px-6 py-4 font-medium whitespace-nowrap"},re={class:"px-6 py-4"},ue={class:"px-6 py-4"},ie={class:"px-6 py-4"},pe={class:"px-6 py-4"},de={class:"px-6 py-4"},me={class:"px-6 py-4"},_e={class:"mt-5"},he={key:1},we={__name:"leaderboard",setup(m){const{$axios:y}=Z(),u=H(),_=x(!1),l=x(null),i=x(u.query.page?parseInt(u.query.page):1),h=x(""),p=x(u.query.batch?u.query.batch:""),d=x(u.query.per_page?parseInt(u.query.per_page):50),w=async()=>{try{const s={};h.value&&(s.search=h.value),d.value&&(s.limit=d.value),i.value&&(s.page=i.value),p.value&&p.value!=="All Batch"&&(s.batch=p.value);const{data:n}=await y.get("/exam/submissions",{params:s});l.value=n}catch(s){console.log(s.message)}},R=async()=>{try{_.value=!0;const{status:s}=await y.post("/exam/calculate");s===200&&(G().add({title:"Marks calculated"}),_.value=!1,w())}catch(s){console.log(s.message),_.value=!1}},q=I();L([p,d,i],()=>{w(),q.push({query:{batch:p.value,per_page:d.value,page:i.value}}),window.scrollTo(0,0)}),E(h,()=>{w()},1e3),F(()=>{w()});const D=async()=>{try{const s=l.value.submissions.map(a=>{let t=a.subjects;return t||(t={"Physics 2nd Paper":0,"Physics 1st Paper":0,"Chemistry 1st Paper":0,"Chemistry 2nd Paper":0,"Higher Math 1st Paper":0,"Higher Math 2nd Paper":0}),{Name:a.user.name,Phone:a.user.phone,Institute:a.user.institute,Batch:a.user.batch,Duration:a.duration?U(a.duration,72e5):"",Score:a.marks,Status:a.status,"Submitted At":a.submittedAt?j(a.submittedAt):"","Started At":j(a.createdAt),"Registeted At":j(a.user.createdAt),...Object.keys(t).reduce((P,C)=>(P[C]=t[C],P),{})}}),n=Object.keys(s[0]),k=s.map(a=>n.map(t=>JSON.stringify(a[t])).join(","));k.unshift(n.join(","));const b=k.join(`\r
`),V=new Blob([b],{type:"text/csv"}),A=window.URL.createObjectURL(V),f=document.createElement("a");f.href=A,f.download="potemedi_submissions.csv",f.click()}catch(s){console.log(s.message)}};return(s,n)=>{const k=M,b=N,V=J,A=K,f=Q,a=W;return o(l)?(g(),v("div",Y,[e("h1",ee," Submissions - Total "+r(o(l).totalResults)+" Students ",1),e("div",te,[c(b,{label:"Search"},{default:S(()=>[c(k,{modelValue:o(h),"onUpdate:modelValue":n[0]||(n[0]=t=>B(h)?h.value=t:null),placeholder:"Search"},null,8,["modelValue"])]),_:1}),e("div",se,[e("div",null,[c(V,{onClick:R,loading:o(_)},{default:S(()=>[T(" Calculate Marks ")]),_:1},8,["loading"])]),e("div",null,[c(V,{onClick:D},{default:S(()=>[T(" Export to CSV ")]),_:1})]),c(b,{label:"Per Page"},{default:S(()=>[c(A,{options:[10,50,100,500,o(l).totalResults],modelValue:o(d),"onUpdate:modelValue":n[1]||(n[1]=t=>B(d)?d.value=t:null),placeholder:"Per page"},null,8,["options","modelValue"])]),_:1}),c(b,{label:"Batch"},{default:S(()=>[c(A,{options:["All Batch",...o(X)],modelValue:o(p),"onUpdate:modelValue":n[2]||(n[2]=t=>B(p)?p.value=t:null),placeholder:"HSC Batch"},null,8,["options","modelValue"])]),_:1})])]),o(l)&&o(l).submissions?(g(),v("div",oe,[e("table",ae,[ne,e("tbody",null,[(g(!0),v(O,null,$(o(l).submissions,(t,P)=>(g(),v("tr",{key:t.user._id,class:"border-b"},[e("td",le,r(o(h)?"":(o(i)-1)*o(d)+P+1),1),e("th",ce,r(t.user.name),1),e("td",re,r(t.user.phone),1),e("td",ue,r(t.user.institute),1),e("td",ie,r(t.user.batch),1),e("td",pe,r(t.duration?("millisecToTime"in s?s.millisecToTime:o(U))(t.duration,72e5):""),1),e("td",de,r(t.marks),1),e("td",me,r(t.subjects),1)]))),128))])])])):z("",!0),e("div",_e,[c(f,{class:"mx-auto",modelValue:o(i),"onUpdate:modelValue":n[3]||(n[3]=t=>B(i)?i.value=t:null),"page-count":o(l).limit,total:o(l).totalResults},null,8,["modelValue","page-count","total"])])])):(g(),v("div",he,[c(a)]))}}};export{we as default};
